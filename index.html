<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Git PR Review</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .pr-list {
            height: 70vh;
            overflow-y: auto;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
        }
        .pr-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .pr-item:hover {
            background: #f9f9f9;
        }
        .pr-details {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .comment-box {
            margin-top: 15px;
        }
        textarea {
            width: 100%;
            min-height: 100px;
            resize: vertical;
            margin-top: 5px;
        }
        button {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            margin-left: 10px;
            font-size: 0.9em;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- CDN Scripts -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script>
        // Mock data (replace with real API calls in production)
        const mockPRs = Array.from({ length: 100 }, (_, i) => ({
            id: i + 1,
            title: `PR #${i + 1}: Feature Update`,
            author: `user${i % 5 + 1}`,
            status: ['open', 'review', 'merged'][i % 3],
            comments: []
        }));

        // Virtualized List Component
        const PRList = ({ prs, onSelect }) => {
            const [visibleRange, setVisibleRange] = React.useState({ start: 0, end: 20 });
            const listRef = React.useRef(null);

            const handleScroll = () => {
                if (!listRef.current) return;
                const { scrollTop, clientHeight } = listRef.current;
                const itemHeight = 50; // Approximate height of each PR item
                const start = Math.floor(scrollTop / itemHeight);
                const end = Math.min(start + Math.ceil(clientHeight / itemHeight) + 5, prs.length);
                setVisibleRange({ start, end });
            };

            React.useEffect(() => {
                const list = listRef.current;
                list.addEventListener('scroll', handleScroll);
                return () => list.removeEventListener('scroll', handleScroll);
            }, []);

            const visiblePRs = prs.slice(visibleRange.start, visibleRange.end);

            return (
                <div ref={listRef} className="pr-list">
                    {visiblePRs.map(pr => (
                        <div
                            key={pr.id}
                            className="pr-item"
                            onClick={() => onSelect(pr)}
                        >
                            {pr.title} - {pr.author} <span className="status">({pr.status})</span>
                        </div>
                    ))}
                </div>
            );
        };

        // PR Details Component
        const PRDetails = ({ pr, onAddComment }) => {
            const [comment, setComment] = React.useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (comment.trim()) {
                    onAddComment(pr.id, comment);
                    setComment('');
                }
            };

            if (!pr) return <div className="pr-details">Select a PR to view details</div>;

            return (
                <div className="pr-details">
                    <h2>{pr.title}</h2>
                    <p>Author: {pr.author} | Status: {pr.status}</p>
                    <div className="comment-box">
                        <h3>Comments</h3>
                        {pr.comments.map((c, i) => (
                            <p key={i}>{c}</p>
                        ))}
                        <form onSubmit={handleSubmit}>
                            <textarea
                                value={comment}
                                onChange={(e) => setComment(e.target.value)}
                                placeholder="Add a comment..."
                            />
                            <button type="submit">Add Comment</button>
                        </form>
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [prs, setPRs] = React.useState(mockPRs);
            const [selectedPR, setSelectedPR] = React.useState(null);

            const addComment = (prId, comment) => {
                setPRs(prevPRs =>
                    prevPRs.map(pr =>
                        pr.id === prId ? { ...pr, comments: [...pr.comments, comment] } : pr
                    )
                );
            };

            return (
                <div className="container">
                    <h1>Git PR Review</h1>
                    <PRList prs={prs} onSelect={setSelectedPR} />
                    <PRDetails pr={selectedPR} onAddComment={addComment} />
                </div>
            );
        };

        // Render the app
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
